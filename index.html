<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="style/main.css">
<script src="script/$.js"></script>
<script src="node_modules/underscore/underscore.js"></script>
<script src="node_modules/underscore.string/dist/underscore.string.min.js"></script>
<script>
_.mixin(_.str.exports());
</script>
<title>PhiDo</title>
<script>
$(function(){
require('nw.gui').Window.get().showDevTools();
var simteconf = require('simteconf');
var phiConf = simteconf('phido.conf', {
   skipNames: ['//', '#']
});
var encodingGED = phiConf.last('EncodingGoldED') || 'utf8';
var encodingHPT = phiConf.last('EncodingHPT')    || 'utf8';
var confGED = simteconf(phiConf.last('ConfigGoldED'), {
   encoding: encodingGED,
   skipNames: ['//', '#', '-'+'-']
});
var areas = simteconf(phiConf.last('AreasHPT'), {
   encoding: encodingHPT,
   skipNames: ['#'],
   prefixGroups: [
      'NetmailArea',
      'BadArea',
      'DupeArea',
      'LocalArea',
      'EchoArea'
   ]
});
var UserName = phiConf.first('UserName') || confGED.first('UserName') || 'незнакомец';
$('center').html(
   '<p><img src="icon/PhiDo-32x32.png"></p>' +
   'Добро пожаловать, <b>'+UserName+'!</b>'
);
var echoNames = areas.group('EchoArea').names();
if( echoNames.length > 0 ){
   $('center').after('<ul id="areaList"></ul>');
   echoNames = _(echoNames).sortBy(function(value){return value;}); // stable
   _(echoNames).each(function(echoName){
      $('#areaList').append('<li>'+_.escapeHTML(echoName)+'</li>');
   });
}
});
</script>
</head>
<body>
<center><img src="img/loading.gif"><br>
loading configuration…</center>
</body>
</html>
